# ğŸ“‹ Eat What - å°ˆæ¡ˆäº¤æ¥èˆ‡é–‹ç™¼æŒ‡å— (Handover Document)

æœ¬æ–‡ä»¶æ—¨åœ¨æä¾›ã€ŒEat Whatã€å°ˆæ¡ˆçš„å®Œæ•´æŠ€è¡“ç´°ç¯€ï¼Œä»¥ä¾¿åœ¨ä¸åŒè£ç½®æˆ–ç”±ä¸åŒ AI Agent æ¥æ‰‹é–‹ç™¼æ™‚ï¼Œèƒ½ç„¡ç¸«éŠœæ¥ç›®å‰é€²åº¦ã€‚

---

## ğŸš€ å°ˆæ¡ˆç‹€æ…‹ç¸½çµ (Current Status)
ç›®å‰å·²å®Œæˆ V1.1 ç‰ˆæœ¬ï¼Œå…·å‚™å®Œæ•´çš„å•ç­”æµç¨‹ã€è‡ªå‹•åŒ–æ’è¡Œã€åœ°ç†ä½ç½®æ•´åˆã€ä»¥åŠå¯æ“´å±•çš„è³‡æ–™å±¤æ¨¡å¼ã€‚

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ§‹è©³è§£
1. **ç‹€æ…‹æ©Ÿç®¡ç† (`lib/quizMachine.ts`)**
   - æ¡ç”¨åš´è¬¹çš„ Reducer æ¨¡å¼ç®¡ç† UI ç‹€æ…‹ã€‚
   - ç‹€æ…‹æµï¼š`questioning` -> `loading` -> `results` (æˆ– `error`)ã€‚
   - æ”¯æ´ `BACK` (å›ä¸Šä¸€é¡Œä¸¦ç§»é™¤æœ€å¾Œç­”æ¡ˆ)ã€`RETRY` (å‡ºéŒ¯å¾Œé‡è©¦) ç­‰é€²éšæ§åˆ¶ã€‚

2. **åœ°ç†ä½ç½®æ•´åˆ (`hooks/useQuiz.ts` & `lib/rankRestaurants.ts`)**
   - **è‡ªå‹•ç²å–åº§æ¨™**ï¼šApp å•Ÿå‹•æ™‚æœƒèª¿ç”¨ `navigator.geolocation`ã€‚
   - **ç²¾æº–è·é›¢è¨ˆç®—**ï¼šä½¿ç”¨ **Haversine Formula (æµ·ä½›æ–¯å…¬å¼)** è¨ˆç®—ä½¿ç”¨è€…èˆ‡é¤å»³é–“çš„çœŸå¯¦è·é›¢ã€‚
   - **å‹•æ…‹æ’åº**ï¼šè·é›¢è³‡è¨Šæœƒåƒèˆ‡æ’è¡Œè¨ˆç®—ï¼ˆåŒåˆ†æ™‚è¿‘è€…å„ªå…ˆï¼‰ã€‚

3. **å¯æ’æ‹”è³‡æ–™å±¤ (`repositories/restaurantRepository.ts`)**
   - å¯¦ä½œäº† **Repository Pattern**ã€‚
   - **Mock æ¨¡å¼**ï¼šè®€å– `data/mock.ts`ã€‚
   - **API æ¨¡å¼**ï¼š(ç’°å¢ƒè®Šæ•¸ `NEXT_PUBLIC_DATA_SOURCE=api`) ä¸²æ¥ `app/api/restaurants/route.ts` ä¸¦é€šé Zod é©—è­‰ã€‚

4. **æ¨™ç±¤æ’è¡Œæ¼”ç®—æ³• (`lib/rankRestaurants.ts`)**
   - æ”¯æ´ **Explainability (å¯è§£é‡‹æ€§)**ï¼šæä¾› `reasons[]` è§£é‡‹æ¨è–¦ç†ç”±ã€‚

---

## âŒ¨ï¸ äº¤äº’è¦ç¯„
| å‹•ä½œ | éµç›¤å¿«æ·éµ | æ‰‹å‹¢ (Mobile) |
| :--- | :--- | :--- |
| **å·¦é¸é …** | `Left Arrow` | å‘å·¦æ»‘ |
| **å³é¸é …** | `Right Arrow` | å‘å³æ»‘ |
| **è·³é (Skip)** | `Space` / `Up Arrow` | **å‘ä¸Šæ»‘** |
| **å›ä¸Šä¸€é¡Œ** | `Backspace` | (é ‚éƒ¨è¿”å›åœ–ç¤º) |

---

## ğŸ› ï¸ ä¸‹ä¸€æ­¥è¨ˆç•« (Roadmap)
å»ºè­°æ¥æ‰‹çš„å¤¥ä¼´æˆ– Agent ä¾åºåŸ·è¡Œä»¥ä¸‹ä»»å‹™ï¼š

1. **è¦–è¦ºè³‡è¨Šè±å¯ŒåŒ– (Visual Enrichment)**
   - åŠ å…¥é¤å»³å°é¢åœ– (imageUrl) èˆ‡è©•åˆ†ç³»çµ±ã€‚
2. **æŒä¹…åŒ–ç´€éŒ„ (Persistence)**
   - ä½¿ç”¨ `localStorage` å„²å­˜ä½¿ç”¨è€…çš„æ­·å²åå¥½ã€‚
3. **åˆ†äº«åŠŸèƒ½ (Social)**
   - ç”¢ç”Ÿæ¨è–¦çµæœçš„åˆ†äº«é€£çµæˆ–åœ–ç‰‡ã€‚

---

## ğŸ¤– çµ¦æ¥æ‰‹ Agent çš„åŸ·è¡Œ Prompt (è¤‡è£½å³ç”¨)

### æŒ‡ä»¤ Aï¼šåŠ å…¥é¤å»³åœ–ç‰‡èˆ‡é«˜ç´š UI (æ¨è–¦åŸ·è¡Œ)
> "è«‹ç¾åŒ– `RestaurantCard`ã€‚
> 1. ä¿®æ”¹ `schemas/restaurant.ts` èˆ‡ `data/mock.ts` åŠ å…¥ `imageUrl` (è«‹ç”¨ `generate_image` ç”Ÿæˆç¾é£Ÿåœ–ç‰‡ä½œç‚ºç¤ºç¯„)ã€‚
> 2. åœ¨ `RestaurantCard` é ‚éƒ¨åŠ å…¥åœ–ç‰‡é¡¯ç¤ºå€åŸŸï¼ˆä½¿ç”¨ `aspect-video` æ¯”ä¾‹ï¼‰ã€‚
> 3. åŠ å…¥æ˜Ÿç­‰è©•åˆ† (Rating) é¡¯ç¤ºã€‚
> 4. ç¢ºä¿ `AnimatePresence` çš„æ‘ºç–Šå‹•ç•«åœ¨åŠ å…¥åœ–ç‰‡å¾Œä¾ç„¶æ»‘é †ã€‚"

### æŒ‡ä»¤ Bï¼šå¯¦ä½œæœ¬åœ°ç´€éŒ„æŒä¹…åŒ–
> "è«‹å¯¦ä½œåå¥½æŒä¹…åŒ–ã€‚
> 1. ä¿®æ”¹ `hooks/useQuiz.ts`ï¼Œç•¶ä½¿ç”¨è€…å®Œæˆä¸€æ¬¡æ¸¬é©—æ™‚ï¼Œå°‡æ¨è–¦å‡ºçš„ Top 1 é¤å»³å„²å­˜è‡³ `localStorage`ã€‚
> 2. åœ¨ `Home` é é¢åˆæ¬¡è¼‰å…¥æ™‚ï¼Œè‹¥æœ‰æ­·å²ç´€éŒ„ï¼Œåœ¨é–‹å§‹æŒ‰éˆ•ä¸Šæ–¹é¡¯ç¤ºä¸€å€‹ã€ä¸Šæ¬¡æ¨è–¦ï¼šXXXXã€çš„å¿«å–æç¤ºã€‚"

### æŒ‡ä»¤ Cï¼šå¢åŠ æ›´å¤šé¡Œç›®èˆ‡æ¨™ç±¤
> "è«‹æ“´å±•å•ç­”å…§å®¹ã€‚
> 1. åœ¨ `data/mock.ts` ä¸­å¢åŠ  3 é¡Œé—œæ–¼ã€é ç®—ã€ã€ã€ç”¨é¤æ°£æ°›ã€ã€ã€ç•°åœ‹æ–™ç†é¡åˆ¥ã€çš„é¡Œç›®ã€‚
> 2. æ›´æ–°é¤å»³çš„ `tags` ä»¥ç¢ºä¿é€™äº›æ–°é¡Œç›®èƒ½å°æ‡‰åˆ°ç¾æœ‰çš„é¤å»³ã€‚
> 3. ç¢ºä¿ `rankRestaurants.ts` ä¾ç„¶èƒ½æ­£ç¢ºè¨ˆç®—åŠ æ¬Šã€‚"

---

## ğŸ“¦ å¸¸ç”¨é–‹ç™¼æŒ‡ä»¤
- **å•Ÿå‹•é–‹ç™¼**: `npm run dev`
- **ä½¿ç”¨ API æ¨¡å¼**: `NEXT_PUBLIC_DATA_SOURCE=api npm run dev`
- **åŸ·è¡Œæ¸¬è©¦**: `npx vitest run`
- **æ­£å¼ç·¨è­¯**: `npm run build`

---

## âš ï¸ Settings Storage æ³¨æ„äº‹é …ï¼ˆP0ï¼‰
ç›®å‰æ¨è–¦æµç¨‹æœƒè®€å– `UserSettings`ï¼ˆtheme/model/question length/search radiusï¼‰ã€‚  
è‹¥ DB å°šæœªå¥—ç”¨æœ€æ–° migrationï¼Œ`/api/settings` æœƒå›å‚³ `SETTINGS_STORAGE_UNAVAILABLE`ã€‚

### åˆå§‹åŒ–å»ºè­°é †åº
1. `npx prisma generate`
2. `npx prisma migrate dev`
3. `npm run dev`

### Fail-open è¡Œç‚º
- ç•¶ `UserSettings` storage ä¸å¯ç”¨æ™‚ï¼š
  - æ¨è–¦æµç¨‹æœƒ fallback `default + local runtime settings`ï¼Œé¿å…æ•´é«”ä¸­æ–·
  - è¨­å®šé é›²ç«¯æŒä¹…åŒ–æš«æ™‚ä¸å¯ç”¨ï¼Œä½†æœ¬æ©Ÿè¨­å®šä»å¯ç”¨
